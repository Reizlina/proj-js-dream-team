{"mappings":"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","sources":["src/js/modal.js"],"sourcesContent":["import { UnsplashApi } from './themoviedb';\n\nimport { renderSpinner } from './spiner';\n\nconst unsplashApi = new UnsplashApi();\nconst modalContainer = document.querySelector('#js-module');\nconst backdrop = document.querySelector('[data-modal]');\nconst gallaryList = document.querySelector('.gallery__list');\n\nexport function renderFilms(film) {\n  if (film.poster_path === null) {\n    film.poster_path =\n      'https://thumbs.dreamstime.com/b/%D1%81%D0%BA%D0%BE%D1%80%D0%BE-%D0%BD%D0%B0-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE%D0%B9-%D0%B4%D0%BE%D1%81%D0%BA%D0%B5-%D0%BF%D0%BE%D1%8F%D0%B2%D0%B8%D1%82%D1%81%D1%8F-%D0%BF%D0%BB%D0%B0%D0%BA%D0%B0%D1%82-retro-%D1%81%D0%B2%D0%B5%D1%82%D1%8F%D1%89%D0%B8%D0%B9%D1%81%D1%8F-%D0%BD%D0%B5%D0%BE%D0%BD-159994270.jpg';\n  } else {\n    film.poster_path = 'https://image.tmdb.org/t/p/w500/' + film.poster_path;\n  }\n\n  if (!film.genre_ids) {\n    film.genre_ids = 'genre unknown';\n  }\n\n  return `<div class=\"modal__backcall\">\n        <div class=\"modal__img-box\">\n          <img\n            class=\"modal__img\"\n            src=${film.poster_path} alt=${film.original_title}\n          />\n        </div>\n        <div class=\"modal__text-content\">\n          <h2 class=\"modal__title\">${film.title}</h2>\n          <div class=\"modal__dicr\">\n            <ul class=\"modal__list1\">\n              <li class=\"modal__list-item\">Vote / Votes</li>\n              <li class=\"modal__list-item\">Popularity</li>\n              <li class=\"modal__list-item\">Original Title</li>\n              <li class=\"modal__list-item\">Genre</li>\n            </ul>\n            <ul class=\"modal__list2\">\n              <li class=\"modal__item\">\n                <span class=\"modal__vote1\">${film.vote_average}</span> /\n                <span class=\"modal__vote2\">${film.vote_count}</span>\n              </li>\n              <li class=\"modal__item\">${film.popularity}</li>\n              <li class=\"modal__item\">${film.title}</li>\n              <li class=\"modal__item\">${film.genre_ids}</li>\n            </ul>\n          </div>\n          <article class=\"modal__article\">\n            <h3 class=\"modal__subtitle\">About</h3>\n            <p class=\"modal__text\">\n             ${film.overview}\n            </p>\n          </article>\n          <div class=\"modal__btn-box\">\n            <button class=\"modal__button-org\" type=\"button\">\n              add to Watched\n            </button>\n            <button class=\"modal__button-trans\" type=\"button\">\n              add to queue\n            </button>\n          </div>\n        </div>\n  </div>`;\n}\n// localStorage.setItem('watched', '');\n// localStorage.setItem('queue', '');\n\nconst WATCHED = 'watched';\nconst QUEUE = 'queue';\n\nconst watched = [];\nconst queue = [];\n\nfunction openModal(event) {\n  if (event.target.nodeName === 'UL') {\n    return;\n  }\n\n  document.body.insertAdjacentHTML('beforebegin', renderSpinner());\n\n  const liId = event.target.closest('[data-id]').getAttribute('data-id');\n\n  unsplashApi\n    .infoAboutFilm(liId)\n    .then(({ data }) => {\n      backdrop.classList.toggle('is-hidden');\n\n      modalContainer.innerHTML = renderFilms(data);\n\n      // btn refs\n      const btnWatched = document.querySelector('.modal__button-org');\n      const btnQueue = document.querySelector('.modal__button-trans');\n\n      // ! WATCHED\n\n      let watchedDataFromStorage = null;\n\n      try {\n        watchedDataFromStorage = localStorage.getItem(WATCHED);\n        watchedDataFromStorage =\n          watchedDataFromStorage === null\n            ? []\n            : JSON.parse(watchedDataFromStorage);\n      } catch (error) {\n        console.error('Get state error: ', error.message);\n      }\n\n      // const watchedDataFromStorage = JSON.parse(\n      //   localStorage.getItem('watched')\n      // );\n\n      // !!!\n      const watchedFilmFromStorage = watchedDataFromStorage.find(\n        el => el.id === data.id\n      );\n\n      if (watchedFilmFromStorage) {\n        btnWatched.addEventListener('click', onHandleRemoveWatch);\n        btnWatched.textContent = 'remove from watched';\n      } else {\n        btnWatched.addEventListener('click', onHandleWatch);\n      }\n\n      function onHandleWatch() {\n        let watchedArr = [];\n\n        if (!localStorage.getItem(WATCHED)) {\n          watchedArr.push(data);\n          localStorage.setItem(WATCHED, JSON.stringify(watchedArr));\n\n          btnWatched.removeEventListener('click', onHandleWatch);\n          btnWatched.textContent = 'remove from watched';\n          btnWatched.addEventListener('click', onHandleRemoveWatch);\n          // снять обработчик\n        } else if (\n          localStorage.getItem(WATCHED).includes(JSON.stringify(data))\n        ) {\n          console.log('Watched film list includes this film!');\n        } else {\n          watchedArr = JSON.parse(localStorage.getItem(WATCHED));\n          watchedArr.push(data);\n          localStorage.setItem(WATCHED, JSON.stringify(watchedArr));\n\n          btnWatched.removeEventListener('click', onHandleWatch);\n          btnWatched.textContent = 'remove from watched';\n          btnWatched.addEventListener('click', onHandleRemoveWatch);\n          // снять обработчик\n        }\n      }\n\n      function onHandleRemoveWatch() {\n        const watchedFilm = JSON.parse(localStorage.getItem(WATCHED));\n\n        const watchedFilmToRemove = watchedFilm.findIndex(\n          el => el.id === data.id\n        );\n\n        watchedFilm.splice(watchedFilmToRemove, 1);\n\n        localStorage.setItem(WATCHED, JSON.stringify(watchedFilm));\n\n        btnWatched.removeEventListener('click', onHandleRemoveWatch);\n        btnWatched.textContent = 'add to Watched';\n        btnWatched.addEventListener('click', onHandleWatch);\n      }\n\n      // ! QUEUE\n\n      let queueDataFromStorage = null;\n\n      try {\n        queueDataFromStorage = localStorage.getItem(QUEUE);\n        queueDataFromStorage =\n          queueDataFromStorage === null ? [] : JSON.parse(queueDataFromStorage);\n      } catch (error) {\n        console.error('Get state error: ', error.message);\n      }\n\n      // const queueDataFromStorage = JSON.parse(\n      //   localStorage.getItem('watched')\n      // );\n\n      // !!!\n      const queueFilmFromStorage = queueDataFromStorage.find(\n        el => el.id === data.id\n      );\n\n      if (queueFilmFromStorage) {\n        btnQueue.addEventListener('click', onHandleRemoveQueue);\n        btnQueue.textContent = 'remove from queue';\n      } else {\n        btnQueue.addEventListener('click', onHandleQueue);\n      }\n\n      function onHandleQueue() {\n        let queueArr = [];\n\n        if (!localStorage.getItem(QUEUE)) {\n          queueArr.push(data);\n          localStorage.setItem(QUEUE, JSON.stringify(queueArr));\n\n          btnQueue.removeEventListener('click', onHandleQueue);\n          btnQueue.textContent = 'remove from queue';\n          btnQueue.addEventListener('click', onHandleRemoveQueue);\n          // снять обработчик\n        } else if (localStorage.getItem(QUEUE).includes(JSON.stringify(data))) {\n          console.log('queue film list includes this film!');\n        } else {\n          queueArr = JSON.parse(localStorage.getItem(QUEUE));\n          queueArr.push(data);\n          localStorage.setItem(QUEUE, JSON.stringify(queueArr));\n\n          btnQueue.removeEventListener('click', onHandleQueue);\n          btnQueue.textContent = 'remove from queue';\n          btnQueue.addEventListener('click', onHandleRemoveQueue);\n          // снять обработчик\n        }\n      }\n\n      function onHandleRemoveQueue() {\n        const queueFilm = JSON.parse(localStorage.getItem(QUEUE));\n\n        const queueFilmToRemove = queueFilm.findIndex(el => el.id === data.id);\n\n        queueFilm.splice(queueFilmToRemove, 1);\n\n        localStorage.setItem(QUEUE, JSON.stringify(queueFilm));\n\n        btnQueue.removeEventListener('click', onHandleRemoveQueue);\n        btnQueue.textContent = 'add to queue';\n        btnQueue.addEventListener('click', onHandleQueue);\n      }\n\n      // // btns listeners\n      // btnQueue.addEventListener('click', onClickQueue);\n\n      // !!!\n    })\n    .finally(() => {\n      document.querySelector('.backdrop-loader').remove();\n    });\n\n  const closeModalBtn = document.querySelector('.close');\n\n  closeModalBtn.addEventListener('click', toggleModal);\n\n  window.addEventListener('keydown', closeModalEsc);\n\n  backdrop.addEventListener('click', closeModalBackdrop);\n\n  function closeModalBackdrop(event) {\n    if (event.target === event.currentTarget) {\n      toggleModal();\n    }\n  }\n\n  function closeModalEsc(event) {\n    if (event.code === 'Escape') {\n      toggleModal();\n    }\n  }\n\n  function toggleModal() {\n    backdrop.classList.toggle('is-hidden');\n    closeModalBtn.removeEventListener('click', toggleModal);\n    window.removeEventListener('keydown', closeModalEsc);\n    backdrop.removeEventListener('click', closeModalBackdrop);\n  }\n}\ngallaryList.addEventListener('click', openModal);\n\n// !!!\n"],"names":["$662h5","parcelRequire","$8a7e756c566dd1ea$var$unsplashApi","UnsplashApi","$8a7e756c566dd1ea$var$modalContainer","document","querySelector","$8a7e756c566dd1ea$var$backdrop","$8a7e756c566dd1ea$var$gallaryList","addEventListener","event1","target","nodeName","body","insertAdjacentHTML","$kyRuT","renderSpinner","liId","closest","getAttribute","infoAboutFilm","then","data","film","classList","toggle","innerHTML","poster_path","genre_ids","original_title","title","vote_average","vote_count","popularity","overview","btnWatched","btnQueue","watchedDataFromStorage","localStorage","getItem","JSON","parse","error","console","message","onHandleWatch","watchedArr","includes","stringify","log","push","setItem","removeEventListener","textContent","onHandleRemoveWatch","watchedFilm","watchedFilmToRemove","findIndex","el","id","splice","find","queueDataFromStorage","error1","onHandleQueue","queueArr","onHandleRemoveQueue","queueFilm","queueFilmToRemove","finally","remove","closeModalBtn","closeModalBackdrop","event","currentTarget","toggleModal","closeModalEsc","code","window"],"version":3,"file":"index.97659d50.js.map"}